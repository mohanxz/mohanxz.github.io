<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | Aromahut</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-orange: #ff6b00;
      --dark-orange: #e05a00;
    }
    
    body {
      font-family: 'Open Sans', sans-serif;
      background-color: #f8f9fa;
    }
    
    .sidebar {
      background-color: #343a40;
      color: white;
      height: 100vh;
      position: fixed;
      width: 250px;
    }
    
    .sidebar-header {
      padding: 20px;
      background-color: var(--dark-orange);
    }
    
    .sidebar-menu {
      padding: 0;
      list-style: none;
    }
    
    .sidebar-menu li {
      padding: 10px 20px;
      border-bottom: 1px solid #4e545a;
    }
    
    .sidebar-menu li a {
      color: white;
      text-decoration: none;
    }
    
    .sidebar-menu li:hover {
      background-color: #4e545a;
    }
    
    .main-content {
      margin-left: 250px;
      padding: 20px;
    }
    
    .card {
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      margin-bottom: 20px;
      border: none;
    }
    
    .card-header {
      background-color: var(--primary-orange);
      color: white;
      border-radius: 10px 10px 0 0 !important;
    }
    
    .status-badge {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }
    
    .status-completed {
      background-color: #d4edda;
      color: #155724;
    }
    
    .btn-orange {
      background-color: var(--primary-orange);
      color: white;
      border: none;
    }
    
    .btn-orange:hover {
      background-color: var(--dark-orange);
      color: white;
    }
    
    .order-item {
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .order-item:hover {
      background-color: #f8f9fa;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>Aromahut Admin</h3>
    </div>
    <ul class="sidebar-menu">
      <li><a href="#" class="active">Orders</a></li>
      <li><a href="#">Products</a></li>
      <li><a href="#">Customers</a></li>
      <li><a href="#">Reports</a></li>
      <li><a href="#">Settings</a></li>
    </ul>
  </div>
  
  <div class="main-content">
    <div class="container-fluid">
      <div class="row mb-4">
        <div class="col-12">
          <h2>Order Management</h2>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Recent Orders</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>Order ID</th>
                      <th>Date</th>
                      <th>Customer</th>
                      <th>Amount</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="orders-table">
                    <!-- Orders will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Order Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="order-details-content">
          <!-- Order details will be loaded here -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-orange">Print Invoice</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase and other scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  
  <script>
    // Your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      databaseURL: "YOUR_DATABASE_URL",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Reference to orders
    const ordersRef = database.ref('orders');

    // Load orders
    ordersRef.on('value', (snapshot) => {
      const orders = snapshot.val();
      const ordersTable = document.getElementById('orders-table');
      ordersTable.innerHTML = '';
      
      if (!orders) {
        ordersTable.innerHTML = '<tr><td colspan="6" class="text-center">No orders found</td></tr>';
        return;
      }
      
      Object.entries(orders).forEach(([key, order]) => {
        const orderDate = new Date(order.createdAt).toLocaleString();
        const row = document.createElement('tr');
        row.className = 'order-item';
        row.setAttribute('data-id', key);
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${orderDate}</td>
          <td>${order.customer.name}</td>
          <td>₹${order.amount.toFixed(2)}</td>
          <td><span class="status-badge status-${order.status}">${order.status}</span></td>
          <td>
            <button class="btn btn-sm btn-orange view-order" data-id="${key}">View</button>
          </td>
        `;
        ordersTable.appendChild(row);
      });
      
      // Add event listeners to view buttons
      document.querySelectorAll('.view-order').forEach(button => {
        button.addEventListener('click', (e) => {
          const orderId = e.target.getAttribute('data-id');
          viewOrderDetails(orderId);
        });
      });
    });
    
    // View order details
    function viewOrderDetails(orderId) {
      const orderRef = database.ref(`orders/${orderId}`);
      
      orderRef.once('value').then((snapshot) => {
        const order = snapshot.val();
        const modalContent = document.getElementById('order-details-content');
        
        // Format items
        let itemsHtml = '';
        order.items.forEach(item => {
          itemsHtml += `
            <tr>
              <td>${item.name}</td>
              <td>${item.weight}</td>
              <td>${item.quantity}</td>
              <td>₹${item.price.toFixed(2)}</td>
              <td>₹${(item.price * item.quantity).toFixed(2)}</td>
            </tr>
          `;
        });
        
        modalContent.innerHTML = `
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>Order Information</h6>
              <p><strong>Order ID:</strong> ${order.id}</p>
              <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleString()}</p>
              <p><strong>Status:</strong> <span class="status-badge status-${order.status}">${order.status}</span></p>
            </div>
            <div class="col-md-6">
              <h6>Payment Information</h6>
              <p><strong>Payment ID:</strong> ${order.paymentId}</p>
              <p><strong>Amount:</strong> ₹${order.amount.toFixed(2)}</p>
              <p><strong>Currency:</strong> ${order.currency}</p>
            </div>
          </div>
          
          <div class="row mb-4">
            <div class="col-md-6">
              <h6>Customer Information</h6>
              <p><strong>Name:</strong> ${order.customer.name}</p>
              <p><strong>Email:</strong> ${order.customer.email}</p>
              <p><strong>Phone:</strong> ${order.customer.phone}</p>
            </div>
            <div class="col-md-6">
              <h6>Shipping Address</h6>
              <p>${order.shippingAddress}</p>
            </div>
          </div>
          
          <h6>Order Items</h6>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Weight</th>
                  <th>Qty</th>
                  <th>Unit Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                ${itemsHtml}
              </tbody>
              <tfoot>
                <tr>
                  <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                  <td>₹${(order.amount - 2).toFixed(2)}</td>
                </tr>
                <tr>
                  <td colspan="4" class="text-end"><strong>Shipping:</strong></td>
                  <td>₹2.00</td>
                </tr>
                <tr>
                  <td colspan="4" class="text-end"><strong>Total:</strong></td>
                  <td>₹${order.amount.toFixed(2)}</td>
                </tr>
              </tfoot>
            </table>
          </div>
        `;
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
        modal.show();
      });
    }
  </script>
</body>
</html>